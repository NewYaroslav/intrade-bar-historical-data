# Программы для работы с файлами котировок

## xqhtools

*xqhtools* - консольная программа для конвертации и слияния файлов котировок.

Данная программа собрана при помощи компилятора *MinGW-w64* версии *7.3.0* [https://sourceforge.net/projects/mingw-w64/](https://sourceforge.net/projects/mingw-w64/)
Если на вашем компьютере нет необходимых *dll* файлов, их можно взять из архива с компилятором или извлечь из архива *dll.7z*.

Исходные файлы программы можно найти [тут](https://github.com/NewYaroslav/xquotes_history).

### Быстрое использование

Для преобразования файлов *qhs5* в *csv-файлы* нужного вам часового пояса выберите один из двух *bat-файлов*: *build-mt4-msk-csv.bat* или *build-mt4-utc-csv.bat*.
Дождитесь окончания работы программы, после чего в папке *csv* появятся все файлы всех валютных пар.

### Подробное описание возможностей xqhtools

Команды:

* *train* - обучить алгоритм сжатия zstd на конкретном наборе данных. Данная команда необходима для создания словаря.
* *merge* - (Не реализовано полностью) слить файлы котировок или файлы каких либо данных вместе. Пока данная команда работает только с хранилищем Storage и может суммировать подфайлы.
* *convert_csv* - конвертировать csv файлы. Данная команда подходит для конвертации csv файлов в набор hex файлов или в хранилище котировок qhs*
* *convert_storage* - конвертировать qhs* файлы. Данная команда конвертирует файлы qhs* в csv файлы
* *date* - узнать минимальную и максимальную дату котировок файла хранилища
* *version* - версия программы

Переменные:

* *path_hex* - путь к папке с файлами hex
* *path_csv* - путь к файлу котировок в формате csv
* *path_storage* - путь к файлу котировок в формате хранилища котировок qhs*
* *header* - заголовок csv файла (переменная нужна только для преобразования qhs* файлов в csv)
* *path_dictionary* - путь к файлу словаря. Директория должна существовать! (переменная нужна только для команды train)
* *dictionary_name* - имя словаря (переменная нужна только для команды train)
* *path_raw_storage* - путь к хранилищу с данными для обучения алгоритма сжатия (переменная нужна только для команды train)
* *path_raw* - путь к файлам-образцам для обучения алгоритма сжатия (переменная нужна только для команды train)
* *fill_factor* - уровень заполнения от 1 до 100. Переменная нужна для уменьшения количества образцов из выборки для обучения алгоритма сжатия (переменная нужна только для команды train)
* *dictionary_capacity* - размер словарья, по умолчанию 102400 (переменная нужна только для команды train)
* *paths_raw_storages* - файлы хранилищ с данными, колторые нужно слить в одно хранилище (переменная нужна только для команды merge) 
* *path_out_raw_storage* - файл хранилища, куда будут помещены все подфайлы во время слияния (переменная нужна только для команды merge) 

Флаги:

* *-cetgmt* - преобразовать время CET в GMT
* *-eetgmt* - преобразовать время EET в GMT
* *-mskgmt* - преобразовать время MSK в GMT
* *-gmtcet* - преобразовать время GMT в CET
* *-gmteet* - преобразовать время GMT в EET
* *-gmtmsk* - преобразовать время GMT в MSK
* *-finam* - преобразовать время CET в GMT при конвертировании csv файлов 
* *-alpari* - преобразовать время EET в GMT или CET в GMT при конвертировании csv файлов (у ДЦ серверов Альпари с 01.05.2011 года время сервера поменялось с CET на EET)
* *-h* - прочитать заголовок csv файла. Не оказывает влияния
* *-oo* - использовать только цену открытия (open) бара или свечи. 
* *-oc* - использовать только цену закрытия (close) бара или свечи. 
* *-ohlc* - использовать 4 цены бара или свечи (open, high, low, close)
* *-ohlcv* - использовать 4 цены бара или свечи (open, high, low, close) и объем (volume)
* *-c* - использовать сжатие данных (только для преобразования csv в формат хранилища котировок qhs* или для слияния qhs* файлов)
* *-m4* - использовать преобразование qhs* файлов в csv формат для MetaTrader4
* *-m5* - использовать преобразование qhs* файлов в csv формат для MetaTrader5
* *-ducascopy* - использовать преобразование qhs* файлов в csv формат брокера Ducascopy
* *-sbc* - пропускать "плохие" бары во время преобразования qhs* файлов в csv. Плохие бары, это когда отсутствует цена за данную минуту
* *-fbc* - заполнять "плохие" бары во время преобразования qhs* файлов в csv. Заполнение будет происходить последней известной ценой
* *-wbc* - записывать "плохие" бары во время преобразования qhs* файлов в csv
* *-rnd* - перемешать в случайном порядке образцы для обучения алгоритма сжатия (флаг нужен только для команды train)
* *-cpp* - сохранить словарь в виде С++ заголовка (флаг нужен только для команды train)

### Пример использования

Преобразовать csv файл в qhs4 файл с использованием сжатия (флаг *-c*) и преобразованием времени из CET в GMT (флаг *-ohlc*):

```
xqhtools convert_csv path_storage ..\storage\AUDCAD path_csv ..\csv\AUDCAD1.csv -cetgmt -ohlc -c
```

Преобразовать qhs4 файл обратно в csv файл для MetaTrader4 с преобразованием GMT времени в CET (флаг *-gmtcet*) и пропуском плохих баров (*-sbc*)

```
xqhtools convert_storage path_storage ..\storage\AUDCAD.qhs4 path_csv ..\csv\AUDCAD1.csv -gmtcet -m4 -sbc
```

## Программа intrade-bar-downloader

Данная программа скачивает котировки брокера [intrade.bar](https://intrade.bar/), которые совпадают с брокером *FXCM*.

### Особенности использования

* Программа **не скачивает данные во время выходных дней.**
* Программа может скачивать цену *bid*, *ask* или находить цену *(bid+ask)/2*. Последний вариант подходит для бинарных опционов у брокера [intrade.bar](https://intrade.bar/), 5-ти или 3-х значная цена округляется к ближайшему значению (например, 1.6754651 округлится к 1.67547)
* Цена закрытия бара совпадает с ценой, которую фиксирует брокер [intrade.bar](https://intrade.bar/) в начале минуты. Пример:

Бар закрылся, цена закрытия бара *1.90544*
Время бара (время открытия бара): *23:58:00*
Время котировки у брокера *23:59:00*, зачение котировки *1.90544*

**Данное утверждение справедливо, если использовать цену *(bid+ask)/2*!**

* Программа скачивает данные в специальный формат [qhs5](https://github.com/NewYaroslav/xquotes_history). Данный формат использует библиотека [xquotes_history](https://github.com/NewYaroslav/xquotes_history). 
Данный формат содержит все цены бара, а также его объем. Преобразовать данный формат в файл csv можно при помощи специальной утилиты [xqhtools](https://github.com/NewYaroslav/xquotes_history/tree/master/bin).
* Настройки программы можно задать как через аргументы, так и через json файл.
* Программа скачивает котировки всех валютных пар (в том числе и золото), которые есть у брокера [intrade.bar](https://intrade.bar/).

### Быстрое использование

Запустите *bat-файл* *run-intrade-bar-downloader.bat*, после чего дожтиесь завершения работы программы. По умолчанию программа скачает все доступные данные, за исключением текущего дня по UTC.
Настройки запуска программы через *bat-файл* находятся в фале *settings-intrade-bar-downloader.json*.

**Внимание! Программа не умеет определять ранее записанный формат цены в файлах qhs5! Поэтому, если необходимо загрузить цену bid или ask вместо (bid+ask/2), необходимо будет загружать историю с нуля! Файлы из данного репозитория в этом случае вам не нужны!**

### Параметры программы

/path_store | --path_store | /ps | -ps

Директория, где будут располагаться файлы исторических данных

/use_day_off | --use_day_off | /skip_day_off | --skip_day_off | /sdo | -sdo

Переменная типа *bool*, которая включает или отключает пропуск выходных дней (по UTC времени)

/use_current_day | --use_current_day | /skip_current_day | --skip_current_day | /scd | -scd

Переменная типа *bool*, которая включает или отключает пропуск текущего дня (по UTC времени).
Это может пригодиться, если нужно скачать полные дни.

/price_type | --price_type | /pt | -pt

Тип используемой цены. Данный аргумент может принимать значения: <bid>, <ask>, <(bid+ask)/2>

/path_json_file | --path_json_file | /pjf | -pjf

Путь к файлу json с настройками

### Пример командной строки

Пример снизу запишет файлы исторических данных в папку *../storage*, пропустит выходные дни и текущий день, а также использует цену *(bid+ask)/2*.

```
intrade-bar-downloader.exe /use_day_off false /use_current_day false /price_type "(bid+ask)/2" /path_store "../storage"

```
### Пример командной строки для использования настроек из JSON файла

```
intrade-bar-downloader.exe /path_json_file "settings-intrade-bar-downloader.json"
```

### Пример JSON файла

```json
{
	"path_store":"../storage",
	"use_current_day":true,
	"use_day_off":true,
	"price_type":"(bid+ask)/2"
}
```

